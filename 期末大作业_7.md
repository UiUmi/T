#期末大作业_7组
##The code Odyssey
###作者：  
黄悦 10224102408     
魏畇钊   10222140414  
王文宇 10224511407   
##**摘要**
本报告涵盖了一个使用 Pygame 库开发的游戏项目的代码分析。该项目实现了包括角色移动、攻击、跳跃、与物品和怪物的交互等游戏机制。游戏具有城市和关卡两个场景，并包括商店、音乐框、故事框等功能。以下是对项目结构和关键算法的分析。
  
##**一.介绍**
1.1
规则：  
1. WASZ控制的方向  
2.主城的按键用法：  
商店：点击商店购买物品，购买的物品在背包中查看
背包：要想使用购买的商品，要在背包中点击使用（比如在商店中购买的人物形象当时只是查看换装效果，并没有实现人物切换，要在背包中使用）  
光盘：打开和关闭音乐  
story 书本:里面讲述了我们故事发生的背景  
MAP：进行关卡的选择  
3.药水的使用说明：  
H红药水：healthy 药水，一瓶可以补充一颗心  
S蓝药水：speed 药水，可加速  
J绿药水：jump 药水，可跳的更高  
A黄药水：攻击药水，伤害+1  
1.2  
The Code Odyssey（代码之旅）是一款横版闯关游戏，玩家扮演一位程序员，在游戏中要完成各种与编程有关的任务，从而逐步提高自己的编程技能。游戏团队对游戏进行了全方位的美工设计和代码编写，力求打造一个令人沉浸的游戏体验，尤其在以下几个方面：  
**多样化的挑战**  
玩家打开游戏，便打开了编程世界。其中有多个关卡等待玩家探索。每个关卡都有独特的场景和代码错误boss。例如，在第一关中，玩家需要通过操作程序员移动并避开障碍物，若生命值未降到零则能进入新的一关。  
**随机元素**  
游戏注重不可预测性。在每个关卡开始之前，玩家将随机获得装备或者遇到随机事件。这可能包括与游戏世界中的NPC的对话，触发各种有趣的事件，或者获得宝贵的物品。   
**成长体验感**  
玩家不仅可以通过打败敌人来获得经验值，逐渐提升自己的角色等级，还可以通过解锁关卡、完成任务、收集奖励、商店购买等方式提高自己的技能，解锁新的技能和道具，以便在后续的关卡中更好地应对挑战。  
总之，The Code Odyssey是一款充满挑战和乐趣的游戏，不仅能够帮助玩家接触编程的基础知识，还能够让玩家体验到编程的乐趣和创造力。
##**二.基本架构** (主函数介绍)

1. 主循环
游戏的主循环在 while running 中运行，处理游戏中的各种事件，包括鼠标点击、按键操作等。根据事件的类型，执行相应的逻辑，例如切换场景、打开商店、执行角色移动等。

2. 商店页面
在商店页面，根据商品数量动态生成商品的显示位置，并通过鼠标点击购买商品。商店的页面切换通过上一页和下一页按钮实现。

3. 角色移动和交互
通过检测键盘按键状态，实现角色的移动和攻击。玩家可以通过按键实现左右移动、攻击等基本操作。同时，角色还可以执行跳跃操作。

4. 场景切换
游戏包含城市场景和关卡场景，通过点击地图图标实现场景切换。不同场景有不同的背景和怪物生成逻辑。

5. 故事框和音乐框
通过点击故事框按钮，显示故事文本，通过点击音乐框按钮，控制音乐的播放和暂停。这些框体的显示和隐藏通过标志位实现。
##**三.核心算法、技术、美工、界面部分**
### 核心算法
1. **角色移动和交互算法**  
1.1 角色移动
玩家角色的移动通过检测键盘按键状态实现。按下左右键时，更新玩家的 x 坐标，实现左右移动。同时，在没有按下左右键时，玩家停止移动。移动时通过切换奔跑动画帧，实现动画效果。  
1.2 角色攻击  
玩家攻击通过检测 J 键状态实现。按下 J 键时，启动攻击动画，快速移动角色位置，根据角色朝向渲染相应的攻击动画帧。攻击动画持续时间为 0.2 秒
1.3 角色跳跃  
角色跳跃分为起跳和下落两个阶段。按下 W 键时，检测是否在地面上，是则进入起跳阶段。在起跳阶段，角色 y 坐标逐渐减小，模拟向上跳跃。下落阶段通过增加 y 坐标模拟重力效果。
2. **场景切换技术**  
2.1 场景切换逻辑  
通过点击地图图标实现场景切换。根据选择的关卡更改背景图片，实现场景的切换。在不同场景下，怪物的生成和移动逻辑也不同。此外，为实现场景过渡效果，添加了背景图的移动效果。  
2.2 背景图移动  
为实现场景过渡效果，背景图的移动通过更新背景的 x 坐标实现。不同场景下背景图的移动速度可以调整，通过两张背景图的交替移动，实现平滑的过渡效果。  
3. **商店和物品交互技术**  
3.1 商店页面    
商店页面通过动态生成商品显示位置，实现多页商品展示。鼠标点击上一页和下一页按钮实现页面切换。通过检测商品位置，判断鼠标点击的是哪个商品，实现购买商品的逻辑。  
3.2 商品购买逻辑  
商品购买逻辑包括更新主角的属性和状态，例如增加生命值、速度等。通过检测购买的商品类型，执行相应的逻辑。例如，购买生命药水时增加主角的生命值，购买速度药水时增加主角的移动速度，并在一定时间内启动加速状态。
4. **人物攻击设定**  
4.1 设置伤害    
给player_damage赋值即可  
4.2 设置攻击动画  
用pygame.time自带的计时工具计时0.5s，在这0.5s内人物想朝向的方向每帧移动10像素，每帧在人物前渲染player attack animation，实现人物攻击
5. **怪物设定**  
5.1 怪物初始化    
创建Monster类，来初始话不同的怪物，目前实现两种小怪和一个Boss，设定其伤害，生命值，速度之类的属性。  
5.2 创建怪物列表    
用来存储现在存在的怪物，死亡的pop出去，列表元素是一个类，类包含怪物类别，以及这个怪物的实时数据，坐标，攻击时间间隔等，以便后来对其操作的判定    
5.3怪物攻击  
monster1和玩家类似的攻击方式，持续0.5s，10像素的冲击，monster2则是在人物头顶头像炸弹，对炸弹也生成一个列表进行检测判定和坐标位置移动，Boss则相当于一个生成桩，boss存在时隔一段时间就会刷出一些怪物。
	
6. **受伤判定**  
6.1 人物    
被bullet或被怪物冲撞  
6.2 怪物  
被人物攻击并扣血

7. **关卡选择**  
7.1 点击map选择关卡  
检测鼠标点击逻辑，渲染map，并检测点击在哪个关卡上，改变select_level的值进行进入关卡操作  
7.2 进入关卡  
首先替换背景，停止渲染rule等无用的东西，关卡中map也不渲染，然后将初始化好的level1-1的怪物copy进入exiet_monsters列表  
7.3 场景循环后移动  
在level1每个小节怪物死完后，背景循环并进入下一小节  

8. **关卡选择**  
8.1 设置is_in_city变量  
初始化时设置为True，记录人物是否在主城，进入关卡后设置为False  
8.2 死亡和关卡结束结算  
人物死亡后设置为True，每一level结束后也会设置为True  
8.3 当is_in_city为True  
另外设置背景图为city.png即可  


## **美工**
主要利用python、画图工具构建以黄色为主色调的暖色背景、人物与标识，增强游戏带给玩家的亲切舒适感。  
###**界面部分**
游戏的界面包括开始按钮、退出按钮、商店按钮、音乐按钮等。通过 Pygame 的绘制功能实现这些按钮的显示和交互。同时，通过文本渲染实现故事文本和商品价格的显示。
##**四.分工以及发展历程心得**
### 分工：
- 初始规划：黄悦、魏畇钊、王文宇
- 算法设计与代码编写：黄悦、魏畇钊
- 美工设计：王文宇、魏畇钊
- 报告撰写：黄悦、魏畇钊、王文宇

### 发展历程：
- 初始概念和规划阶段：确定了将编程与冒险游戏相结合的核心概念。进行小范围调研，挖掘了编程教育需求和冒险游戏的经典与情感，为游戏的整体规划和设计奠定基础。

- 美术设计和角色设定：着重于界面设计和角色设定，创造了游戏的背景世界和人物形象，旨在通过精心设计和细致绘画为游戏创造引人入胜的视觉体验。

- 编程和关卡设计：进行算法设计、编程和关卡设计工作，使用多种编程语言和引擎（如Python），实现游戏的功能和交互性。设计不同类型的关卡并变换难度，增加游戏的挑战性和乐趣。

- 测试和优化：在游戏开发的后期阶段，进行大量测试和优化工作，邀请志愿者玩家参与测试，收集反馈意见，并对游戏进行调整和改进，确保流畅性、平衡性和可玩性。

游戏开发是一个复杂而迭代的过程，通过不断规划、设计、测试和更新，《代码之旅》逐步完善，为玩家提供优质游戏体验。

     